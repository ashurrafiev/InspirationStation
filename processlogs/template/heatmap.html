{%- if not maxx %}{%- set maxx = heatmap|max %}{%- endif %}
<svg width="{{ 1 + bin_size*heatmap|length }}" height="{{ 80 if legend else 60 }}">

{%- for h in range(1, end_hour-start_hour) %}
{%- set x = bin_size*h*60/bin %}
<text x="{{ x }}" y="10" text-anchor="middle" style="fill:#777">{{ h+start_hour }}:00</text>
<line x1="{{ x }}" y1="12" x2="{{ x }}" y2="17" style="stroke:#999" />
{%- endfor %}

{%- for x in heatmap %}
<rect x="{{ bin_size*loop.index0 }}" y="17" width="{{ bin_size }}" height="43" style="fill:{{ heat_gradient_i(x, maxx) }};stroke:none" />
{%- endfor %}
<line x1="0" y1="17" x2="{{ bin_size*heatmap|length }}" y2="17" style="stroke:#999" />

{%- if legend %}
{%- for x in [0, 1, maxx//2, maxx] %}
<rect x="{{ 40*loop.index0 }}" y="64" width="16" height="16" style="fill:{{ heat_gradient_i(x, maxx) }};stroke:none" />
<text x="{{ 20+40*loop.index0 }}" y="73" text-anchor="start" dominant-baseline="middle" style="fill:#777">{{ x }}</text>
{%- endfor %}
{%- endif %}

</svg>
